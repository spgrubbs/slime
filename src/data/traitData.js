// Mutation library - abilities learned by defeating monsters
// Mutations are unlocked by killing 100 of the associated monster type
// VISC scaling: many effects scale with the slime's viscosity stat
// Format: baseValue + (viscScale * viscosity)

export const MUTATION_LIBRARY = {
  // === VERDANT FOREST MUTATIONS ===
  sharp: {
    name: 'Sharp',
    icon: 'ðŸ”ª',
    stat: 'firmness',
    bonus: 2,
    passive: 'sharp',
    passiveDesc: (visc) => `${(10 + 0.25 * visc).toFixed(1)}% auto-crit chance`,
    baseChance: 10,
    viscScale: 0.25,
    color: '#94a3b8',
    requiredKills: 100,
    monster: 'youngWolf',
    elementBonus: null,
  },
  digest: {
    name: 'Digest',
    icon: 'ðŸŒ±',
    stat: 'viscosity',
    bonus: 2,
    passive: 'digest',
    passiveDesc: (visc) => `+${(5 + 0.5 * visc).toFixed(1)} biomass per kill`,
    baseValue: 5,
    viscScale: 0.5,
    color: '#22c55e',
    requiredKills: 100,
    monster: 'venusSlimetrap',
    elementBonus: { nature: 5 },
  },
  stoneskin: {
    name: 'Stoneskin',
    icon: 'ðŸª¨',
    stat: 'firmness',
    bonus: 2,
    passive: 'stoneskin',
    passiveDesc: (visc) => `+${(5 + 0.1 * visc).toFixed(1)} Firmness`,
    baseValue: 5,
    viscScale: 0.1,
    color: '#a16207',
    requiredKills: 100,
    monster: 'pebblet',
    elementBonus: { earth: 5 },
  },
  vinewebs: {
    name: 'Vinewebs',
    icon: 'ðŸ•¸ï¸',
    stat: 'slipperiness',
    bonus: 2,
    passive: 'vinewebs',
    passiveDesc: (visc) => `${(10 + 0.25 * visc).toFixed(1)}% chance to block enemy attack`,
    baseChance: 10,
    viscScale: 0.25,
    color: '#65a30d',
    requiredKills: 100,
    monster: 'vineSpider',
    elementBonus: { nature: 3 },
  },
  resurrect: {
    name: 'Resurrect',
    icon: 'ðŸ§š',
    stat: 'viscosity',
    bonus: 3,
    passive: 'resurrect',
    passiveDesc: (visc) => `Revive with ${(1 + 2 * visc).toFixed(0)} HP after death`,
    baseValue: 1,
    viscScale: 2,
    color: '#4ade80',
    requiredKills: 200, // Rare monster
    monster: 'lifeFairy',
    elementBonus: { nature: 8 },
  },

  // === MURKY SWAMP MUTATIONS ===
  spiny: {
    name: 'Spiny',
    icon: 'ðŸŸ',
    stat: 'firmness',
    bonus: 2,
    passive: 'spiny',
    passiveDesc: (visc) => `${(10 + 0.4 * visc).toFixed(1)}% chance to cause Bleed`,
    baseChance: 10,
    viscScale: 0.4,
    color: '#ef4444',
    requiredKills: 100,
    monster: 'serratedCarp',
    elementBonus: { water: 3 },
  },
  whirlpool: {
    name: 'Whirlpool',
    icon: 'ðŸŒ€',
    stat: 'viscosity',
    bonus: 3,
    passive: 'whirlpool',
    passiveDesc: (visc) => `+${(5 + 0.3 * visc).toFixed(1)}% damage to fleeing enemies`,
    baseValue: 5,
    viscScale: 0.3,
    color: '#3b82f6',
    requiredKills: 100,
    monster: 'antSeaLion',
    elementBonus: { water: 5 },
  },
  farstep: {
    name: 'Farstep',
    icon: 'ðŸ‘Ÿ',
    stat: 'slipperiness',
    bonus: 3,
    passive: 'farstep',
    passiveDesc: (visc) => `${(25 + 0.4 * visc).toFixed(1)}% chance to avoid traps`,
    baseChance: 25,
    viscScale: 0.4,
    color: '#06b6d4',
    requiredKills: 100,
    monster: 'swampStrider',
    elementBonus: { water: 3 },
  },
  ethereal: {
    name: 'Ethereal',
    icon: 'ðŸ‘»',
    stat: 'slipperiness',
    bonus: 3,
    passive: 'ethereal',
    passiveDesc: (visc) => `${(10 + 0.5 * visc).toFixed(1)}% chance to phase through damage`,
    baseChance: 10,
    viscScale: 0.5,
    color: '#8b5cf6',
    requiredKills: 100,
    monster: 'wilOWisp',
    elementBonus: { fire: 3 },
  },
  theTouch: {
    name: 'The Touch',
    icon: 'ðŸŒ',
    stat: 'viscosity',
    bonus: 4,
    passive: 'theTouch',
    passiveDesc: (visc) => `${(1 + 0.15 * visc).toFixed(2)}% instant kill chance`,
    baseChance: 1,
    viscScale: 0.15,
    color: '#fbbf24',
    requiredKills: 300, // Rare
    monster: 'theSnail',
    elementBonus: null,
  },

  // === CRYSTAL GROTTO MUTATIONS ===
  lifesteal: {
    name: 'Lifesteal',
    icon: 'ðŸ¦‡',
    stat: 'viscosity',
    bonus: 2,
    passive: 'lifesteal',
    passiveDesc: (visc) => `${(10 + 0.2 * visc).toFixed(1)}% of damage heals you`,
    baseChance: 10,
    viscScale: 0.2,
    color: '#dc2626',
    requiredKills: 100,
    monster: 'vampireBat',
    elementBonus: null,
  },
  sloughSkin: {
    name: 'Slough Skin',
    icon: 'ðŸª±',
    stat: 'firmness',
    bonus: 3,
    passive: 'sloughSkin',
    passiveDesc: (visc) => `${(25 + 0.5 * visc).toFixed(1)}% chance to remove debuff`,
    baseChance: 25,
    viscScale: 0.5,
    color: '#a16207',
    requiredKills: 100,
    monster: 'rockWorm',
    elementBonus: { earth: 5 },
  },
  blindingPowder: {
    name: 'Blinding Powder',
    icon: 'âœ¨',
    stat: 'slipperiness',
    bonus: 3,
    passive: 'blindingPowder',
    passiveDesc: (visc) => `${(10 + 0.25 * visc).toFixed(1)}% chance enemy misses`,
    baseChance: 10,
    viscScale: 0.25,
    color: '#fcd34d',
    requiredKills: 100,
    monster: 'coalSprite',
    elementBonus: { earth: 3 },
  },
  dropIn: {
    name: 'Drop In',
    icon: 'â¬‡ï¸',
    stat: 'firmness',
    bonus: 3,
    passive: 'dropIn',
    passiveDesc: (visc) => `First attack: +${(10 + 0.5 * visc).toFixed(1)}% damage`,
    baseValue: 10,
    viscScale: 0.5,
    color: '#6b7280',
    requiredKills: 100,
    monster: 'stalagMite',
    elementBonus: { earth: 5 },
  },
  bejeweled: {
    name: 'Bejeweled',
    icon: 'ðŸ’Ž',
    stat: 'viscosity',
    bonus: 3,
    passive: 'bejeweled',
    passiveDesc: (visc) => `+${(25 + 0.2 * visc).toFixed(1)}% personal biomass gain`,
    baseValue: 25,
    viscScale: 0.2,
    color: '#3b82f6',
    requiredKills: 300, // Rare
    monster: 'sapphireNewt',
    elementBonus: { water: 8 },
  },

  // === CINDERSPIRE MUTATIONS ===
  regenerate: {
    name: 'Regenerate',
    icon: 'ðŸ’š',
    stat: 'viscosity',
    bonus: 3,
    passive: 'regenerate',
    passiveDesc: (visc) => `Heal ${(2 + 0.3 * visc).toFixed(1)} HP per turn`,
    baseValue: 2,
    viscScale: 0.3,
    color: '#22c55e',
    requiredKills: 100,
    monster: 'embermander',
    elementBonus: { fire: 5 },
  },
  alloyPotential: {
    name: 'Alloy Potential',
    icon: 'ðŸ¤–',
    stat: 'firmness',
    bonus: 2,
    passive: 'alloyPotential',
    passiveDesc: () => 'Unlocks +2 mutation slots',
    special: 'extraSlots',
    extraSlots: 2,
    color: '#94a3b8',
    requiredKills: 100,
    monster: 'animatedAlloy',
    elementBonus: { earth: 3 },
  },
  pyrolyze: {
    name: 'Pyrolyze',
    icon: 'ðŸ”¥',
    stat: 'viscosity',
    bonus: 3,
    passive: 'pyrolyze',
    passiveDesc: (visc) => `${(15 + 0.3 * visc).toFixed(1)}% chance to Burn`,
    baseChance: 15,
    viscScale: 0.3,
    color: '#f97316',
    requiredKills: 100,
    monster: 'magmaOoze',
    elementBonus: { fire: 5 },
  },
  ghastlyWail: {
    name: 'Ghastly Wail',
    icon: 'ðŸ’€',
    stat: 'viscosity',
    bonus: 3,
    passive: 'ghastlyWail',
    passiveDesc: (visc) => `${(15 + 0.3 * visc).toFixed(1)}% chance enemy skips turn`,
    baseChance: 15,
    viscScale: 0.3,
    color: '#6b7280',
    requiredKills: 100,
    monster: 'burntSpirit',
    elementBonus: null,
  },
  draconicPower: {
    name: 'Draconic Power',
    icon: 'ðŸ²',
    stat: 'firmness',
    bonus: 3,
    passive: 'draconicPower',
    passiveDesc: (visc) => `+${(3 + 0.15 * visc).toFixed(1)} to all base stats`,
    baseValue: 3,
    viscScale: 0.15,
    color: '#dc2626',
    requiredKills: 400, // Rare
    monster: 'wyrm',
    elementBonus: { fire: 10 },
  },

  // === STORMSPIRE SUMMIT MUTATIONS ===
  chainLightning: {
    name: 'Chain Lightning',
    icon: 'âš¡',
    stat: 'slipperiness',
    bonus: 3,
    passive: 'chainLightning',
    passiveDesc: (visc) => `+${(15 + 0.3 * visc).toFixed(1)}% dmg with 3+ party`,
    baseValue: 15,
    viscScale: 0.3,
    color: '#fbbf24',
    requiredKills: 100,
    monster: 'thunderHawk',
    elementBonus: null,
  },
  earthshaker: {
    name: 'Earthshaker',
    icon: 'ðŸ‘¹',
    stat: 'firmness',
    bonus: 4,
    passive: 'earthshaker',
    passiveDesc: (visc) => `${(10 + 0.3 * visc).toFixed(1)}% chance to stun 1 turn`,
    baseChance: 10,
    viscScale: 0.3,
    color: '#a16207',
    requiredKills: 100,
    monster: 'boulderTroll',
    elementBonus: { earth: 5 },
  },
  charged: {
    name: 'Charged',
    icon: 'ðŸ”‹',
    stat: 'slipperiness',
    bonus: 3,
    passive: 'charged',
    passiveDesc: (visc) => `+${(15 + 0.3 * visc).toFixed(1)}% crit damage`,
    baseValue: 15,
    viscScale: 0.3,
    color: '#3b82f6',
    requiredKills: 100,
    monster: 'stormElemental',
    elementBonus: { water: 5 },
  },
  permafrost: {
    name: 'Permafrost',
    icon: 'â„ï¸',
    stat: 'viscosity',
    bonus: 3,
    passive: 'permafrost',
    passiveDesc: (visc) => `${(12 + 0.3 * visc).toFixed(1)}% to reduce enemy dmg 25%`,
    baseChance: 12,
    viscScale: 0.3,
    color: '#06b6d4',
    requiredKills: 100,
    monster: 'frostGiant',
    elementBonus: { water: 5 },
  },
  stormcaller: {
    name: 'Stormcaller',
    icon: 'ðŸŒ©ï¸',
    stat: 'slipperiness',
    bonus: 4,
    passive: 'stormcaller',
    passiveDesc: (visc) => `+${(10 + 0.25 * visc).toFixed(1)}% crit for whole party`,
    baseValue: 10,
    viscScale: 0.25,
    color: '#8b5cf6',
    requiredKills: 500, // Rare
    monster: 'thunderbird',
    elementBonus: null,
  },

  // === VOID ABYSS MUTATIONS ===
  consume: {
    name: 'Consume',
    icon: 'ðŸ¦‘',
    stat: 'firmness',
    bonus: 3,
    passive: 'consume',
    passiveDesc: (visc) => `+${(2 + 0.2 * visc).toFixed(1)} random stat on kill (max 5)`,
    baseValue: 2,
    viscScale: 0.2,
    color: '#4c1d95',
    requiredKills: 100,
    monster: 'voidTendril',
    elementBonus: null,
  },
  allSeeing: {
    name: 'All-Seeing',
    icon: 'ðŸ‘ï¸',
    stat: 'slipperiness',
    bonus: 4,
    passive: 'allSeeing',
    passiveDesc: (visc) => `Cannot be crit, +${(5 + 0.2 * visc).toFixed(1)}% dodge`,
    baseValue: 5,
    viscScale: 0.2,
    color: '#7c3aed',
    requiredKills: 100,
    monster: 'abyssalWatcher',
    elementBonus: null,
  },
  nullify: {
    name: 'Nullify',
    icon: 'ðŸ”³',
    stat: 'viscosity',
    bonus: 4,
    passive: 'nullify',
    passiveDesc: (visc) => `${(50 + 0.5 * visc).toFixed(0)}% reduced status duration`,
    baseValue: 50,
    viscScale: 0.5,
    color: '#374151',
    requiredKills: 100,
    monster: 'nullConstruct',
    elementBonus: null,
  },
  fracture: {
    name: 'Fracture',
    icon: 'ðŸ’¥',
    stat: 'firmness',
    bonus: 3,
    passive: 'fracture',
    passiveDesc: (visc) => `On death: deal ${(50 + visc).toFixed(0)}% max HP as dmg`,
    baseValue: 50,
    viscScale: 1,
    color: '#dc2626',
    requiredKills: 100,
    monster: 'realityShard',
    elementBonus: null,
  },
  voidTouched: {
    name: 'Void Touched',
    icon: 'ðŸ•³ï¸',
    stat: 'viscosity',
    bonus: 5,
    passive: 'voidTouched',
    passiveDesc: (visc) => `+${(10 + 0.4 * visc).toFixed(1)}% dmg, ignores resist`,
    baseValue: 10,
    viscScale: 0.4,
    color: '#0f0f23',
    requiredKills: 600, // Rare
    monster: 'hollowOne',
    elementBonus: null,
  },
};

// Backward compatibility alias - will be removed in future
export const TRAIT_LIBRARY = MUTATION_LIBRARY;

// Status effects that can be applied in combat
export const STATUS_EFFECTS = {
  poison: { name: 'Poison', icon: 'ðŸ§ª', color: '#22c55e', dmg: 2, dur: 5 },
  burn: { name: 'Burn', icon: 'ðŸ”¥', color: '#f97316', dmg: 3, dur: 4 },
  bleed: { name: 'Bleed', icon: 'ðŸ©¸', color: '#ef4444', dmg: 4, dur: 3 },
  stun: { name: 'Stun', icon: 'ðŸ’«', color: '#fbbf24', dmg: 0, dur: 1 },
  weakened: { name: 'Weakened', icon: 'â¬‡ï¸', color: '#6b7280', dmg: 0, dur: 2 },
};

// Personality traits - behavioral modifiers that slimes can acquire
// Separate from mutations (combat abilities)
// All traits now have titles for slime naming
export const SLIME_TRAITS = {
  // Common positive traits
  brave: { name: 'Brave', icon: 'ðŸ¦', desc: '+5% damage when HP below 50%', rarity: 'common', title: ' the Brave' },
  cautious: { name: 'Cautious', icon: 'ðŸ›¡ï¸', desc: '+5% dodge when HP below 50%', rarity: 'common', title: ' the Cautious' },
  hardy: { name: 'Hardy', icon: 'ðŸ’ª', desc: '+3% max HP', rarity: 'common', title: ' the Mighty' },
  swift: { name: 'Swift', icon: 'âš¡', desc: '+3% crit chance', rarity: 'common', title: ' the Swift' },
  wise: { name: 'Wise', icon: 'ðŸ§ ', desc: '+5% element gain rate', rarity: 'common', title: ' the Wise' },

  // Uncommon positive traits
  lucky: { name: 'Lucky', icon: 'ðŸ€', desc: '+5% material drop rate', rarity: 'uncommon', title: ' the Lucky' },
  greedy: { name: 'Greedy', icon: 'ðŸ’°', desc: '+5% biomass gain', rarity: 'uncommon', title: ' the Greedy' },
  resilient: { name: 'Resilient', icon: 'ðŸ”„', desc: 'Recover 1 HP per kill', rarity: 'uncommon', title: ' the Resilient' },
  fierce: { name: 'Fierce', icon: 'ðŸ˜¤', desc: '+8% damage on first attack', rarity: 'uncommon', title: ' the Fierce' },

  // Common neutral/negative traits (add flavor)
  lazy: { name: 'Lazy', icon: 'ðŸ˜´', desc: '-5% damage, +10% ranch effectiveness', rarity: 'common', title: ' the Lazy' },
  timid: { name: 'Timid', icon: 'ðŸ˜°', desc: '+10% dodge, -5% damage', rarity: 'common', title: ' the Timid' },
  curious: { name: 'Curious', icon: 'ðŸ”', desc: '+10% exploration event chance', rarity: 'common', title: ' the Curious' },

  // Uncommon mixed traits
  reckless: { name: 'Reckless', icon: 'ðŸ’¥', desc: '+10% damage, +5% damage taken', rarity: 'uncommon', title: ' the Reckless' },
  glutton: { name: 'Glutton', icon: 'ðŸ–', desc: '+10% biomass gain, -3% max HP', rarity: 'uncommon', title: ' the Glutton' },

  // Rare traits (from specific ranches only)
  void: { name: 'Void', icon: 'ðŸ•³ï¸', desc: 'Cannot gain elemental affinity', rarity: 'rare', source: 'nullifier', title: ' the Void' },
  adaptable: { name: 'Adaptable', icon: 'ðŸ”€', desc: '+50% elemental affinity gain', rarity: 'rare', title: ' the Adaptable' },

  // Legendary traits (premium currency only)
  ancient: { name: 'Ancient', icon: 'ðŸ“œ', desc: '+1 mutation slot', rarity: 'legendary', title: ' the Ancient' },
  primordial: { name: 'Primordial', icon: 'ðŸŒŸ', desc: '+10% all stats', rarity: 'legendary', title: ' the Primordial' },
};

// Rarity colors for traits
export const TRAIT_RARITY_COLORS = {
  common: '#9ca3af',
  uncommon: '#22c55e',
  rare: '#a855f7',
  legendary: '#f59e0b',
};

// Helper function to get mutation description with current VISC value
export const getMutationDesc = (mutationId, viscosity = 0) => {
  const mut = MUTATION_LIBRARY[mutationId];
  if (!mut) return '';
  if (typeof mut.passiveDesc === 'function') {
    return mut.passiveDesc(viscosity);
  }
  return mut.passiveDesc;
};
